"use strict";
const language_core_1 = require("@volar/language-core");
const typescript_1 = require("@volar/typescript");
const language_js_1 = require("./language.js");
const externalFiles = new WeakMap();
const init = (modules) => {
    const { typescript: ts } = modules;
    const pluginModule = {
        create(info) {
            const virtualFiles = (0, language_core_1.createVirtualFiles)([(0, language_js_1.getLanguageModule)(ts)]);
            (0, typescript_1.decorateLanguageService)(virtualFiles, info.languageService, true);
            (0, typescript_1.decorateLanguageServiceHost)(virtualFiles, info.languageServiceHost, ts, ['.astro']);
            return info.languageService;
        },
        getExternalFiles(project) {
            if (!externalFiles.has(project)) {
                externalFiles.set(project, (0, typescript_1.getExternalFiles)(ts, project, ['.astro']));
            }
            return externalFiles.get(project);
        },
    };
    return pluginModule;
};
module.exports = init;
